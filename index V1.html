<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Parciales ‚Äî Ingenier√≠a</title>
<meta name="description" content="Explorador de parciales por materia y a√±o" />
<style>
  :root {
    --bg: #0b0d10;
    --panel: #12151a;
    --text: #e6e8eb;
    --muted: #9aa3ad;
    --accent: #4ea1ff;
    --border: #1f242c;
    --hover: #151a21;
    --link: #a6d1ff;
    --ok: #61d095;
    --warn: #ffb84e;
    --err: #ff6b6b;
    --shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  .light {
    --bg: #f6f8fb;
    --panel: #ffffff;
    --text: #101418;
    --muted: #5b6876;
    --accent: #0e63ff;
    --border: #e6eaf0;
    --hover: #f2f5f9;
    --link: #0e63ff;
    --ok: #1f8a5b;
    --warn: #b46a00;
    --err: #b13636;
    --shadow: 0 8px 20px rgba(0,0,0,.08);
  }

  * { box-sizing: border-box; }
  html, body { height: 100%; }
  body {
    margin: 0;
    font: 14px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
  }

  .wrap {
    max-width: 1100px;
    margin: 0 auto;
    padding: 24px 16px 64px;
  }

  header.site {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 12px;
    align-items: center;
    margin-bottom: 16px;
  }
  .title {
    display: flex; gap: 12px; align-items: baseline;
  }
  .title h1 {
    margin: 0; font-size: 22px; letter-spacing: .2px;
  }
  .title .sub {
    color: var(--muted); font-size: 13px;
  }

  .actions {
    display: flex; gap: 8px; align-items: center;
  }
  button, select, input[type="search"] {
    background: var(--panel);
    color: var(--text);
    border: 1px solid var(--border);
    padding: 10px 12px;
    border-radius: 10px;
    box-shadow: var(--shadow);
  }
  button:hover, select:hover, input[type="search"]:hover { background: var(--hover); }
  button {
    cursor: pointer;
  }

  .toolbar {
    display: grid;
    grid-template-columns: 1fr auto auto;
    gap: 10px;
    margin: 8px 0 16px;
  }
  .toolbar .search {
    position: relative;
  }
  .toolbar .search input {
    width: 100%;
    padding-left: 40px;
  }
  .toolbar .search svg {
    position: absolute; left: 12px; top: 50%; transform: translateY(-50%);
    pointer-events: none; opacity: .7;
  }

  nav.breadcrumbs {
    font-size: 13px; color: var(--muted);
    display: flex; gap: 6px; align-items: center;
    margin: 10px 0 6px;
    flex-wrap: wrap;
  }
  nav.breadcrumbs a {
    color: var(--link); text-decoration: none;
  }
  nav.breadcrumbs .sep { opacity: .4; }

  .panel {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 14px;
    box-shadow: var(--shadow);
    overflow: clip;
  }

  .list {
    width: 100%;
    border-collapse: collapse;
  }
  .list thead {
    background: var(--hover);
  }
  .list th, .list td {
    padding: 12px 14px;
    border-bottom: 1px solid var(--border);
    text-align: left;
    vertical-align: middle;
  }
  .list th {
    font-weight: 600; color: var(--muted); font-size: 12px; text-transform: uppercase; letter-spacing: .4px;
  }
  .row {
    text-decoration: none; color: var(--text); display: flex; align-items: center; gap: 10px;
  }
  .row:hover { text-decoration: underline; }

  .nameCell { display: flex; align-items: center; gap: 10px; }
  .type-badge {
    display: inline-block; font-size: 11px; padding: 2px 8px; border-radius: 999px; border: 1px solid var(--border); color: var(--muted);
  }
  .hint {
    margin-top: 12px; color: var(--muted); font-size: 12px;
  }

  .empty {
    padding: 18px 14px; color: var(--muted);
  }

  /* responsive */
  @media (max-width: 720px) {
    .toolbar { grid-template-columns: 1fr; }
    .hide-sm { display: none; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <header class="site">
      <div class="title">
        <h1>Parciales ‚Äî Ingenier√≠a</h1>
        <span class="sub">Biblioteca por materia y a√±o</span>
      </div>
      <div class="actions">
        <button id="themeToggle" title="Cambiar tema">üåì Modo</button>
      </div>
    </header>

    <nav class="breadcrumbs" id="breadcrumbs"></nav>

    <div class="toolbar">
      <div class="search">
        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M10 4a6 6 0 0 1 4.472 9.994l4.267 4.267l-1.414 1.414l-4.267-4.267A6 6 0 1 1 10 4m0 2a4 4 0 1 0 0 8a4 4 0 0 0 0-8"/></svg>
        <input id="q" type="search" placeholder="Buscar por nombre‚Ä¶" autocomplete="off" />
      </div>
      <select id="sortBy" aria-label="Ordenar por">
        <option value="name">Ordenar: Nombre (A‚ÜíZ)</option>
        <option value="date">Ordenar: Fecha (reciente primero)</option>
      </select>
      <button id="goUp" title="Subir nivel">‚¨ÜÔ∏è Subir</button>
    </div>

    <div class="panel">
      <table class="list" role="grid" aria-label="Listado de elementos">
        <thead>
          <tr>
            <th>Nombre</th>
            <th class="hide-sm">Tipo</th>
            <th class="hide-sm">Fecha</th>
          </tr>
        </thead>
        <tbody id="rows">
          <!-- filas renderizadas por JS -->
        </tbody>
      </table>
      <div class="empty" id="empty" hidden>No hay elementos que coincidan.</div>
    </div>

    <div class="hint">
      Sugerencia: m√°s adelante pod√©s agregar un <code>index.json</code> dentro de cada carpeta para que se liste autom√°ticamente sin tocar el HTML. Si no hay, se usa una estructura de demo.
    </div>
  </div>

<script>
(function() {
  // ---------- ICONOS SVG (inline, livianos) ----------
  const Icons = {
    folder: `<svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M10 4l2 2h8a2 2 0 0 1 2 2v1H2V6a2 2 0 0 1 2-2z"/><path fill="currentColor" d="M2 9h20v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2z"/></svg>`,
    file: `<svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path fill="currentColor" d="M14 2v6h6"/></svg>`,
    pdf: `<svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M6 2h8l6 6v12a2 2 0 0 1-2 2H6z"/><text x="7" y="17" font-size="7" fill="#fff" font-family="Arial, sans-serif">PDF</text></svg>`,
    zip: `<svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><rect x="4" y="2" width="16" height="20" rx="2" fill="currentColor"/><path fill="#fff" d="M10 5h4v2h-4V5m0 3h4v2h-4V8m0 3h4v2h-4v-2m0 3h4v2h-4v-2"/></svg>`,
  };

  // ---------- DEMO DE ESTRUCTURA (se usa si no hay index.json) ----------
  // Nodos: { name, type: "dir"|"file", ext?, date?, children? }
  const demo = {
    name: "",
    type: "dir",
    children: [
      {
        name: "Materias",
        type: "dir",
        date: "2025-03-01",
        children: [
          {
            name: "F√≠sica I",
            type: "dir",
            date: "2025-02-20",
            children: [
              {
                name: "2024",
                type: "dir",
                date: "2025-02-01",
                children: [
                  { name: "Parcial-1.pdf", type: "file", ext: "pdf", date: "2024-05-11" },
                  { name: "Parcial-2.pdf", type: "file", ext: "pdf", date: "2024-07-03" }
                ]
              },
              {
                name: "2023",
                type: "dir",
                date: "2024-08-10",
                children: [
                  { name: "Final-Teor√≠a.pdf", type: "file", ext: "pdf", date: "2023-12-12" }
                ]
              }
            ]
          },
          {
            name: "√Ålgebra I",
            type: "dir",
            date: "2025-02-10",
            children: [
              {
                name: "2024",
                type: "dir",
                date: "2024-11-21",
                children: [
                  { name: "Parcial-√önico.pdf", type: "file", ext: "pdf", date: "2024-10-01" },
                  { name: "TP-1.zip", type: "file", ext: "zip", date: "2024-09-05" }
                ]
              }
            ]
          }
        ]
      }
    ]
  };

  // ---------- RUTEO B√ÅSICO POR HASH ----------
  // Usamos rutas como #/Materias/F√≠sica%20I/2024
  function getPathFromHash() {
    const raw = decodeURIComponent(location.hash.replace(/^#/, ""));
    return raw.startsWith("/") ? raw : ("/" + raw);
  }
  function setPathToHash(path) {
    location.hash = encodeURIComponent(path);
  }

  // ---------- ESTADO ----------
  let currentPath = "/";
  let currentNode = demo; // por defecto
  let datasetRoot = demo;

  const rowsEl = document.getElementById("rows");
  const emptyEl = document.getElementById("empty");
  const bcEl   = document.getElementById("breadcrumbs");
  const qEl    = document.getElementById("q");
  const sortEl = document.getElementById("sortBy");
  const upBtn  = document.getElementById("goUp");

  // ---------- TEMA (oscuro/claro) ----------
  const themeToggle = document.getElementById("themeToggle");
  const applyTheme = (t) => {
    document.body.classList.toggle("light", t === "light");
  };
  const savedTheme = localStorage.getItem("theme") || "dark";
  applyTheme(savedTheme);
  themeToggle.addEventListener("click", () => {
    const now = document.body.classList.contains("light") ? "dark" : "light";
    localStorage.setItem("theme", now);
    applyTheme(now);
  });

  // ---------- FORMATO FECHA ----------
  function fmtDate(iso) {
    if (!iso) return "‚Äî";
    try {
      const d = new Date(iso + (iso.length === 10 ? "T00:00:00" : ""));
      return d.toLocaleDateString("es-AR", { year: "numeric", month: "short", day: "2-digit" });
    } catch { return "‚Äî"; }
  }

  // ---------- CARGA OPCIONAL DE index.json ----------
  // Convenci√≥n: si existe /index.json para la ruta actual, se usa.
  async function tryLoadIndexJSON(path) {
    // Normalizamos: "/" => "./index.json"; otro => "./Materias/index.json", etc.
    const clean = path === "/" ? "." : "." + path;
    const url = clean.replace(/\/+$/, "") + "/index.json";
    try {
      const res = await fetch(url, { cache: "no-store" });
      if (!res.ok) return null;
      const data = await res.json();
      // Esperamos un objeto { name, type, children: [ ... ] }
      if (!data || !data.type) return null;
      return data;
    } catch {
      return null;
    }
  }

  // ---------- BUSCAR NODO POR RUTA EN UN √ÅRBOL DADO ----------
  function findNodeByPath(root, path) {
    if (path === "/" || path === "") return root;
    const parts = path.split("/").filter(Boolean);
    let node = root;
    for (const p of parts) {
      if (!node || node.type !== "dir" || !node.children) return null;
      node = node.children.find(ch => ch.name === p);
      if (!node) return null;
    }
    return node;
  }

  // ---------- RENDER ----------
  function renderBreadcrumbs(path) {
    bcEl.innerHTML = "";
    const frag = document.createDocumentFragment();

    const addCrumb = (label, toPath) => {
      const a = document.createElement("a");
      a.href = "javascript:void(0)";
      a.textContent = label || "Inicio";
      a.addEventListener("click", () => setPathToHash(toPath));
      frag.appendChild(a);
    };

    const parts = path.split("/").filter(Boolean);
    let acc = "/";
    addCrumb("Inicio", "/");
    for (let i = 0; i < parts.length; i++) {
      const sep = document.createElement("span");
      sep.className = "sep";
      sep.textContent = "/";
      frag.appendChild(sep);
      acc += (acc.endsWith("/") ? "" : "/") + parts[i];
      addCrumb(parts[i], acc);
    }
    bcEl.appendChild(frag);
  }

  function iconFor(item) {
    if (item.type === "dir") return Icons.folder;
    if (item.ext === "pdf") return Icons.pdf;
    if (item.ext === "zip") return Icons.zip;
    return Icons.file;
  }

  function sortItems(items, how) {
    const arr = items.slice();
    // Carpeta primero
    arr.sort((a, b) => {
      if (a.type !== b.type) return a.type === "dir" ? -1 : 1;
      if (how === "date") {
        const da = a.date ? Date.parse(a.date) : 0;
        const db = b.date ? Date.parse(b.date) : 0;
        return db - da; // reciente primero
      }
      return a.name.localeCompare(b.name, "es");
    });
    return arr;
  }

  function renderList(node) {
    const q = (qEl.value || "").trim().toLowerCase();
    const sort = sortEl.value;

    let items = (node.children || []).filter(Boolean);
    if (q) {
      items = items.filter(it => it.name.toLowerCase().includes(q));
    }
    items = sortItems(items, sort);

    rowsEl.innerHTML = "";
    if (!items.length) {
      emptyEl.hidden = false;
      return;
    } else {
      emptyEl.hidden = true;
    }

    for (const it of items) {
      const tr = document.createElement("tr");

      const nameTd = document.createElement("td");
      const link = document.createElement("a");
      link.className = "row";
      link.href = "javascript:void(0)";
      link.innerHTML = `${iconFor(it)} <span>${it.name}</span>`;
      link.addEventListener("click", () => {
        if (it.type === "dir") {
          const next = (currentPath === "/" ? "" : currentPath) + "/" + it.name;
          setPathToHash(next);
        } else {
          // En tu sitio real, cambi√° este comportamiento a una URL v√°lida del archivo
          alert("(Demo) Aqu√≠ abrir√≠as el archivo: " + it.name);
        }
      });
      const wrapName = document.createElement("div");
      wrapName.className = "nameCell";
      wrapName.appendChild(link);
      nameTd.appendChild(wrapName);

      const typeTd = document.createElement("td");
      typeTd.className = "hide-sm";
      const badge = document.createElement("span");
      badge.className = "type-badge";
      badge.textContent = it.type === "dir" ? "Carpeta" : (it.ext ? it.ext.toUpperCase() : "Archivo");
      typeTd.appendChild(badge);

      const dateTd = document.createElement("td");
      dateTd.className = "hide-sm";
      dateTd.textContent = fmtDate(it.date);

      tr.appendChild(nameTd);
      tr.appendChild(typeTd);
      tr.appendChild(dateTd);

      rowsEl.appendChild(tr);
    }
  }

  function goUp() {
    if (currentPath === "/" || currentPath === "") return;
    const parts = currentPath.split("/").filter(Boolean);
    parts.pop();
    const up = "/" + parts.join("/");
    setPathToHash(up || "/");
  }

  // ---------- SYNC ESTADO ----------
  async function sync(path) {
    currentPath = path || "/";
    renderBreadcrumbs(currentPath);

    // Intentamos cargar index.json DE ESA RUTA (si existe).
    const jsonNode = await tryLoadIndexJSON(currentPath);
    if (jsonNode) {
      // Si hay index.json en la ruta actual, lo usamos como "nodo actual" directamente.
      currentNode = jsonNode;
      datasetRoot = jsonNode; // para que las rutas internas de ese sub√°rbol funcionen
    } else {
      // Si no hay, usamos el √°rbol demo como dataset.
      datasetRoot = demo;
      currentNode = findNodeByPath(datasetRoot, currentPath) || demo;
    }
    renderList(currentNode);
  }

  // ---------- EVENTOS ----------
  window.addEventListener("hashchange", () => sync(getPathFromHash()));
  qEl.addEventListener("input", () => renderList(currentNode));
  sortEl.addEventListener("change", () => renderList(currentNode));
  upBtn.addEventListener("click", goUp);

  // Primera carga
  if (!location.hash) setPathToHash("/");
  sync(getPathFromHash());
})();
</script>
</body>
</html>
